<!-- NOMA Compilation Flow -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 300" width="1000" height="300">
  <defs>
    <style>
      .title { font-family: monospace; font-size: 16px; font-weight: bold; fill: #ffffff; }
      .label { font-family: monospace; font-size: 13px; fill: #ffffff; }
      .small-text { font-family: monospace; font-size: 11px; fill: #999999; }
      .code-text { font-family: monospace; font-size: 10px; fill: #00ffcc; }
      .box { fill: #2a2a2a; stroke: #00ffcc; stroke-width: 2; rx: 5; }
      .highlight-box { fill: #1a4d4d; stroke: #00ffcc; stroke-width: 3; rx: 5; }
      .arrow { stroke: #00ffcc; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#00ffcc" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1000" height="300" fill="#0d1117"/>

  <!-- Title -->
  <text x="500" y="30" class="title" text-anchor="middle">NOMA Compilation Pipeline: From Source to 16KB Binary</text>

  <!-- Step 1: Source Code -->
  <rect x="20" y="60" width="150" height="180" class="box"/>
  <text x="95" y="85" class="label" text-anchor="middle">Source Code</text>
  <text x="95" y="105" class="code-text" text-anchor="middle">learn W = [0.1];</text>
  <text x="95" y="120" class="code-text" text-anchor="middle">optimize(W) {</text>
  <text x="95" y="135" class="code-text" text-anchor="middle">  loss = W² - 4;</text>
  <text x="95" y="150" class="code-text" text-anchor="middle">  minimize loss;</text>
  <text x="95" y="165" class="code-text" text-anchor="middle">}</text>
  <text x="95" y="190" class="small-text" text-anchor="middle">main.noma</text>
  <text x="95" y="210" class="small-text" text-anchor="middle">Human-readable</text>
  <text x="95" y="225" class="small-text" text-anchor="middle">No gradients yet</text>

  <!-- Arrow 1 -->
  <path d="M 170 150 L 230 150" class="arrow"/>

  <!-- Step 2: Lexer/Parser -->
  <rect x="230" y="90" width="130" height="120" class="box"/>
  <text x="295" y="115" class="label" text-anchor="middle">Lexer/Parser</text>
  <text x="295" y="140" class="small-text" text-anchor="middle">Tokenize source</text>
  <text x="295" y="155" class="small-text" text-anchor="middle">Build AST</text>
  <text x="295" y="170" class="small-text" text-anchor="middle">Validate syntax</text>
  <text x="295" y="195" class="small-text" text-anchor="middle">Output: AST tree</text>

  <!-- Arrow 2 -->
  <path d="M 360 150 L 420 150" class="arrow"/>

  <!-- Step 3: Autodiff Pass (HIGHLIGHT) -->
  <rect x="420" y="60" width="160" height="180" class="highlight-box"/>
  <text x="500" y="85" class="label" text-anchor="middle">AUTODIFF PASS</text>
  <text x="500" y="105" class="code-text" text-anchor="middle">forward: loss = W² - 4</text>
  <text x="500" y="125" class="code-text" text-anchor="middle">backward:</text>
  <text x="500" y="140" class="code-text" text-anchor="middle">  ∂loss/∂W = 2W</text>
  <text x="500" y="160" class="small-text" text-anchor="middle" fill="#00ffcc">✓ Chain rule applied</text>
  <text x="500" y="175" class="small-text" text-anchor="middle" fill="#00ffcc">✓ Gradients computed</text>
  <text x="500" y="190" class="small-text" text-anchor="middle" fill="#00ffcc">✓ Computational graph</text>
  <text x="500" y="210" class="small-text" text-anchor="middle">THIS IS WHERE</text>
  <text x="500" y="225" class="small-text" text-anchor="middle">THE MAGIC HAPPENS</text>

  <!-- Arrow 3 -->
  <path d="M 580 150 L 640 150" class="arrow"/>

  <!-- Step 4: LLVM IR -->
  <rect x="640" y="90" width="130" height="120" class="box"/>
  <text x="705" y="115" class="label" text-anchor="middle">⚙️ LLVM IR Gen</text>
  <text x="705" y="140" class="small-text" text-anchor="middle">Lower to LLVM IR</text>
  <text x="705" y="155" class="small-text" text-anchor="middle">Optimize passes</text>
  <text x="705" y="170" class="small-text" text-anchor="middle">Target: x86_64</text>
  <text x="705" y="195" class="small-text" text-anchor="middle">Output: .ll file</text>

  <!-- Arrow 4 -->
  <path d="M 770 150 L 830 150" class="arrow"/>

  <!-- Step 5: Native Binary -->
  <rect x="830" y="60" width="150" height="180" class="highlight-box"/>
  <text x="905" y="85" class="label" text-anchor="middle">Native Binary</text>
  <text x="905" y="110" class="small-text" text-anchor="middle" fill="#00ffcc">✓ Standalone executable</text>
  <text x="905" y="125" class="small-text" text-anchor="middle" fill="#00ffcc">✓ Zero dependencies</text>
  <text x="905" y="140" class="small-text" text-anchor="middle" fill="#00ffcc">✓ 16-50 KB size</text>
  <text x="905" y="155" class="small-text" text-anchor="middle" fill="#00ffcc">✓ 15x faster</text>
  <text x="905" y="180" class="small-text" text-anchor="middle">Gradients are</text>
  <text x="905" y="195" class="small-text" text-anchor="middle">NATIVE CODE</text>
  <text x="905" y="210" class="small-text" text-anchor="middle">Not runtime calls!</text>
  <text x="905" y="230" class="small-text" text-anchor="middle">./main → runs instantly</text>

  <!-- Bottom comparison -->
  <rect x="20" y="260" width="960" height="30" fill="#1a1a1a" stroke="#444444" stroke-width="1" rx="3"/>
  <text x="500" y="280" class="small-text" text-anchor="middle">
    Compare: PyTorch does autodiff at RUNTIME (slow) | NOMA does it at COMPILE-TIME (fast)
  </text>

</svg>
